function subscribeEvent(e, t, n) { document.addEventListener ? document.addEventListener(e, t, n) : document.attachEvent && document.attachEvent(e, t, n) } function unsubscribeEvent(e, t, n) { document.removeEventListener ? document.removeEventListener(e, t, n) : document.detachEvent && document.detachEvent(e, t, n) } function startActivityHandler(e) { unsubscribeEvent("touchstart", arguments.callee, !1), document.documentElement.onmousemove = null, timeoutSleep(0, placeCssAspxRequest) } function placeCheckerRequest() { var e = getVirtualFolder(), t = addTstampAndSiteToQueryString(getMetatagContent("VIcurrentDateTime")), n = document.createElement("link"); n.setAttribute("rel", "stylesheet"), n.setAttribute("type", "text/css"), n.setAttribute("href", e + "layouts/system/VIChecker.aspx" + t), document.getElementsByTagName("head")[0].appendChild(n) } function placeCssAspxRequest() { var e = getVirtualFolder(), t = addTstampAndSiteToQueryString((new Date).getTime()), n = document.createElement("link"); n.setAttribute("rel", "stylesheet"), n.setAttribute("type", "text/css"), n.setAttribute("href", e + "layouts/system/VisitorIdentificationCSS.aspx" + t), document.getElementsByTagName("head")[0].appendChild(n), timeoutSleep(3e4, placeCheckerRequest) } function timeoutSleep(e, t) { window.setTimeout((function () { t() }), e) } function getMetatagContent(e) { for (var t, n = document.getElementsByTagName("meta"), a = 0; a < n.length; a++)if (n[a].getAttribute("name") === e) { t = n[a].getAttribute("content"); break } return t || (t = "", console.log("Metatag '" + e + "' content is expected to be rendered in document and not to be empty")), t } function addTstampAndSiteToQueryString(e) { var t = "tstamp=" + e, n = window.location.search.match(/sc_site=.*?&|sc_site=.*$/), a = "?" + t; return null !== n && (a = a + "&" + n), a } function getVirtualFolder() { var e = getMetatagContent("VirtualFolder"); return "" === e && (e = "/"), e } document.documentElement.onmousemove = startActivityHandler, subscribeEvent("touchstart", startActivityHandler, !1);
